# Googleカレンダー連携 設定マニュアル

LynxBase予約サイトに、あなたのGoogleカレンダーの予定を表示するための設定手順です。
少し手順が多いですが、この通りに進めれば大丈夫です！

## 手順1: Google Cloud Platform (GCP) でプロジェクトを作る

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセスします。
2. 画面左上のロゴの横にある「プロジェクトの選択（または▼）」をクリックします。
3. 右上の **「新しいプロジェクト」** をクリックします。
4. プロジェクト名に `LynxBase-Scheduler` と入力し、**「作成」** を押します。
   （作成完了まで数秒〜数十秒かかります。通知ベルアイコンで完了を確認してください）

## 手順2: Google Calendar API を有効にする

1. 左上のハンバーガーメニュー（三本線）をクリックし、**「APIとサービス」 > 「ライブラリ」** を選びます。
2. 検索バーに `Google Calendar API` と入力して検索します。
3. 出てきた「Google Calendar API」をクリックし、**「有効にする」** を押します。

## 手順3: サービスアカウント（ロボット）を作る

1. 左上のハンバーガーメニューから **「IAMと管理」 > 「サービスアカウント」** を選びます。
2. 上部の **「+ サービスアカウントを作成」** をクリックします。
3. 以下の通り入力して「作成して続行」を押します。
   - **サービスアカウント名**: `scheduler-bot` （なんでもOK）
   - **ロール（権限）**: 特に設定しなくてOK（「続行」→「完了」でOK）
4. 作成されたリストの中に、メールアドレスっぽいID（例: `scheduler-bot@lynxbase-scheduler-xxxx.iam.gserviceaccount.com`）があります。
   👉 **このメールアドレスをコピーしてメモしてください！（後で使います）**

## 手順4: 「鍵」を発行する

1. 今作ったサービスアカウントのリンク（メールアドレス部分）をクリックします。
2. 上のタブから **「キー」** を選びます。
3. **「鍵を追加」 > 「新しい鍵を作成」** をクリックします。
4. 「JSON」が選ばれている状態で **「作成」** を押します。
5. 自动的にファイルがダウンロードされます。これが「秘密鍵」です。
   👉 **このファイルをテキストエディタ（メモ帳など）で開いてください。**

## 手順5: カレンダーの権限設定

1. 普段使っている **[Googleカレンダー](https://calendar.google.com/)** を開きます。
2. 予約システムに表示させたいカレンダーの「︙（三点リーダー）」 > **「設定と共有」** をクリックします。
3. 下の方にある「特定のユーザーとの共有」の **「ユーザーを追加」** をクリックします。
4. **手順3でコピーしたメールアドレス**（〜@...iam.gserviceaccount.com）を貼り付けます。
5. 権限は **「予定の表示（すべての予定の詳細）」** を選び、「送信」を押します。
   （※これをしないと、システムが予定を読み取れません！）
6. 設定画面の上の方にある「カレンダーID」を探してコピーします。
   👉 **このカレンダーIDをメモしてください！（たぶんあなたのGmailアドレスです）**

## 手順6: サイトに登録する

1. PC内の `sitter-scheduler` フォルダにある **`env.local.example`** というファイルを開きます。
2. 以下の3箇所を埋めてください：
   - `GOOGLE_SERVICE_EMAIL`: 手順3のメールアドレス
   - `GOOGLE_PRIVATE_KEY`: 手順4でダウンロードしたファイルの中にある `"private_key": "-----BEGIN..."` の部分（`"`の中身全部）
   - `GOOGLE_CALENDAR_ID`: 手順5のカレンダーID
3. 入力し終わったら、ファイルを保存します。
4. **ファイル名を `env.local.example` から `.env.local` に変更してください。**
   （先頭のドット `.` を忘れずに！Macだと隠しファイルになることがありますがそれでOKです）

---

## 【重要】Vercelで公開する場合の設定

`.env.local` ファイルはセキュリティのため、GitHubにはアップロードされません。
そのため、Vercelで公開する際は、**Vercelの管理画面で同じ設定を行う必要があります。**

1. Vercelのダッシュボードで、このプロジェクトを開きます。
2. 上のタブから **「Settings」** をクリックします。
3. 左メニューの **「Environment Variables」** を選びます。
4. 以下の3つを、ひとつずつ追加してください：
   
   | Key (キー) | Value (バリュー) |
   | :--- | :--- |
   | `GOOGLE_SERVICE_EMAIL` | （.env.localに入れたサービスアカウントのメール） |
   | `GOOGLE_PRIVATE_KEY` | （.env.localに入れた秘密鍵の全文） |
   | `GOOGLE_CALENDAR_ID` | （.env.localに入れたカレンダーID） |

   ※ `GOOGLE_PRIVATE_KEY` は、`-----BEGIN PRIVATE KEY-----` から `-----END PRIVATE KEY-----` まで、改行を含めて全てコピーして貼り付けてください。

5. 全て追加したら、デプロイ（Redeploy）を行うと反映されます。

---

## 完了！
これで設定は終わりです。
サイトを再起動（ターミナルで `Ctrl+C` して `npm run dev` し直す）すると、
カレンダーにあなたの予定が反映されているはずです！

もし分からなければ、いつでも聞いてくださいね。
